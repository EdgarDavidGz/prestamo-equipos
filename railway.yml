# Nombre de la aplicación de Railway
name: prestamo-equipos

# Versión de PHP
# Cambia el valor por la versión de PHP que necesites
# Puedes verificar las versiones disponibles aquí: https://docs.railway.app/languages/php
env:
  PHP_VERSION: "8.0"

# Servicios de la aplicación
services:
  # Servicio web
  web:
    # Comandos de inicio del servicio
    commands:
      # Comando para instalar las dependencias de Composer
      - "composer install --no-interaction --prefer-dist"

      # Comando para iniciar el servicio web
      - "vendor/bin/heroku-php-nginx -C nginx_app.conf public/"

    # Variables de entorno
    env:
      # Ruta de acceso a la aplicación
      APP_BASE: "/"

    # Archivo de configuración de NGINX
    nginx_app.conf: |
      # Configuración de la ubicación raíz de la aplicación
      location / {
          # Intenta cargar la URL solicitada, si no existe intenta cargar index.php
          try_files $uri $uri/ /index.php?$query_string;
      }

      # Regla de reescritura de URL
      if (!-e $request_filename) {
          rewrite ^/(.*)$ /index.php?$1 last;
      }
